p8105\_hw5\_jak2312
================
Jared Klug

## Problem 1

Read and clean df

``` r
homicide_df = 
  read_csv("./data/homicide/homicide-data.csv") %>% 
  mutate(
    resolved = case_when(
      disposition == "Closed without arrest" ~ "unsolved",
      disposition == "Open/No arrest" ~ "unsolved",
      disposition == "Closed by arrest" ~ "solved"
    ),
    city_state = str_c(city, state, sep = "_")
  ) %>% 
  select(city_state, resolved) %>% 
  filter(city_state != "Tulsa_AL")
```

    ## Parsed with column specification:
    ## cols(
    ##   uid = col_character(),
    ##   reported_date = col_double(),
    ##   victim_last = col_character(),
    ##   victim_first = col_character(),
    ##   victim_race = col_character(),
    ##   victim_age = col_character(),
    ##   victim_sex = col_character(),
    ##   city = col_character(),
    ##   state = col_character(),
    ##   lat = col_double(),
    ##   lon = col_double(),
    ##   disposition = col_character()
    ## )

create aggregate df

``` r
aggregate_df = 
  homicide_df %>% 
    group_by(city_state) %>% 
    summarize(
      hom_total = n(),
      hom_unsolved = sum(resolved == "unsolved")
    ) 
```

    ## `summarise()` ungrouping output (override with `.groups` argument)

run prop test for 1 city

``` r
prop.test(
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_unsolved),
  aggregate_df %>% filter(city_state == "Baltimore_MD") %>% pull(hom_total)
) %>% broom::tidy()
```

    ## # A tibble: 1 x 8
    ##   estimate statistic  p.value parameter conf.low conf.high method    alternative
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>     <chr>      
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample… two.sided

itterate over all the cities

``` r
results_df = 
  aggregate_df %>% 
    mutate(
      prop_test = map2(.x = hom_unsolved, .y = hom_total, ~prop.test(x = .x, n = .y)),
      tidy_test = map(prop_test, broom::tidy)
    ) %>% 
    select(-prop_test) %>% 
    unnest(tidy_test) %>% 
    select(city_state, estimate, conf.low, conf.high)
```

Arrange by estimate

``` r
results_df %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))
```

![](p8105_hw5_jak2312_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

## Problem 2

``` r
study_data = tibble(
    filename = list.files("./data/longitudinal_study/"),
    subject_data = map(str_c("./data/longitudinal_study/", filename), read.csv)
  ) %>% 
  separate(filename, into = c("arm", "subject_id"), sep = "_") %>% 
  mutate(subject_id = str_replace(subject_id, ".csv", ""))
```

``` r
pat_data_long = function(df){
  df %>% pivot_longer(week_1:week_8,
                      names_to = "week",
                      names_prefix = "week_",
                      values_to = "data")
}

for(i in 1:20){
  study_data$subject_data[[i]] = pat_data_long(study_data$subject_data[[i]])
}

study_data
```

    ## # A tibble: 20 x 3
    ##    arm   subject_id subject_data    
    ##    <chr> <chr>      <list>          
    ##  1 con   01         <tibble [8 × 2]>
    ##  2 con   02         <tibble [8 × 2]>
    ##  3 con   03         <tibble [8 × 2]>
    ##  4 con   04         <tibble [8 × 2]>
    ##  5 con   05         <tibble [8 × 2]>
    ##  6 con   06         <tibble [8 × 2]>
    ##  7 con   07         <tibble [8 × 2]>
    ##  8 con   08         <tibble [8 × 2]>
    ##  9 con   09         <tibble [8 × 2]>
    ## 10 con   10         <tibble [8 × 2]>
    ## 11 exp   01         <tibble [8 × 2]>
    ## 12 exp   02         <tibble [8 × 2]>
    ## 13 exp   03         <tibble [8 × 2]>
    ## 14 exp   04         <tibble [8 × 2]>
    ## 15 exp   05         <tibble [8 × 2]>
    ## 16 exp   06         <tibble [8 × 2]>
    ## 17 exp   07         <tibble [8 × 2]>
    ## 18 exp   08         <tibble [8 × 2]>
    ## 19 exp   09         <tibble [8 × 2]>
    ## 20 exp   10         <tibble [8 × 2]>

``` r
study_data$subject_data[[1]]
```

    ## # A tibble: 8 x 2
    ##   week   data
    ##   <chr> <dbl>
    ## 1 1      0.2 
    ## 2 2     -1.31
    ## 3 3      0.66
    ## 4 4      1.96
    ## 5 5      0.23
    ## 6 6      1.09
    ## 7 7      0.05
    ## 8 8      1.94

## Problem 3
